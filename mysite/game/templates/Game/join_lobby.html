{% load static %}

<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>

        <title> Taskmaster </title>
        <link rel="shortcut icon" type="image/x-icon" href="{% static 'favicon-large.png' %}" />
        <link rel="stylesheet" href="{% static 'default.css' %}">
        <link rel="stylesheet" href="{% static 'sidebar.css' %}">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
        <meta name="author" content="Matthew Wood" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body>
        <main id="main" class="main">
            <section id="main-content" class="content-block uni-background">
                <div class="container" style="z-index: 100;">
                    <aside>
                      <div class="top">
                        <div class="logo">
                          <h3>{{username}}</h3>
                          <h2>Taskmaster</h2>
                        <div>
                        <div class="close" id="close-btn">
                          <span class="material-icons-sharp">close</span>
                        </div>
                      </div>
              
                      <div class="sidebar">
                        <a href="/home/">
                          <span class="material-icons-sharp">person_outline</span>
                          <h3>Home</h3>
                        </a>
                        <a href="/game/" class="active">
                          <span class="material-icons-sharp">sports_esports</span>
                          <h3>Game</h3>
                        </a>
                        <a href="/logout/">
                          <span class="material-icons-sharp">grid_view</span>
                          <h3>Logout</h3>
                        </a>
                      </div>
                    </aside>
                </div>
                
                <form id="options" class="options-container center"> 
                    {% csrf_token %}
                    <input type="text" id="enter-code" class="enter-code" name="enter-code" placeholder="Enter code" maxlength="5"><br>
                </form>

                <script>
                  const enterCodeInput = document.getElementById('enter-code');
                  enterCodeInput.addEventListener('input', () => {
                      let code = enterCodeInput.value;
                      if (code.length >= 5) {
                          console.log(code);
                          // Send an AJAX request to a Django view



                          
                          const xhr = new XMLHttpRequest();
                          xhr.onreadystatechange = () => {
                              if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                                  const response = JSON.parse(xhr.responseText);
                                  if (response.exists) {
                                      // Code exists in the Game model, redirect to lobby_view
                                      window.location.href = '/game/lobby';
                                  } else {
                                      // Code does not exist in the Game model, do nothing
                                  }
                              }
                          };
                          xhr.open('GET', `/game/check_code?code=${code}`);
                          xhr.send();
                      }
                  });
              </script>
            
              <div id="user-options" class="button-container center" style="top: 300%">
                  <div id="create-game" class="user-button disable-select" onmousedown="dim(this.id)"
                                                                            onmouseup="undim(this.id)" 
                                                                            onmouseleave="undim(this.id)"
                                                                            onclick="window.location.href = 'create_lobby'"> CREATE GAME 
                  <a href="createlobby.html"></a>
                  </div>

                  <div id="view-games" class="user-button disable-select" onmousedown="dim(this.id)"
                                                                            onmouseup="undim(this.id)" 
                                                                            onmouseleave="undim(this.id)"> VIEW GAMES </div>
              </div>
            </section>
            <section id="info" class="content-block" style="background-color: rgb(255, 134, 158); height: 100vh;"></section>
            <footer id="footer" class="footer"></footer>
        </main>

        <script> src="{% static 'page-logic.js' %}"</script>
        <script src="{% static 'button-dim.js' %}"></script>
    </body>
</html>